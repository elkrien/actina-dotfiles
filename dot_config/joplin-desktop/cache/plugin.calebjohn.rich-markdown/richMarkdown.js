exports.default=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e,n){"use strict";function r(t,e,n){return{name:"RichMarkdownOverlay-"+t,requiredSettings:n,token:function(n){const r=function(t,e){return t.lastIndex=e.pos,t.exec(e.string)}(e,n),i=n.baseToken();if((null==i?void 0:i.type)&&(i.type.includes("jn-inline-code")||i.type.includes("comment")||i.type.includes("katex")))n.pos+=i.size;else{if(r&&r.index===n.pos)return n.pos+=r[0].length||1,t;r?n.pos=r.index:n.skipToEnd()}return null}}}Object.defineProperty(e,"__esModule",{value:!0}),e.remove=e.add=e.table_regex=e.blockquote_regex=e.hr_regex=e.list_token_regex=e.header_regex=e.strike_token_regex=e.sup_token_regex=e.sub_token_regex=e.insert_token_regex=e.highlight_token_regex=e.strong_underline_regex=e.strong_star_regex=e.emph_underline_regex=e.emph_star_regex=e.sup_regex=e.sub_regex=e.insert_regex=e.highlight_regex=e.html_image_regex=e.image_regex=e.link_regex=e.checkbox_inner_regex=e.checkbox_regex=void 0,e.checkbox_regex=/^(\s*)([*+-] )(\[[Xx ]\])\s.*$/g,e.checkbox_inner_regex=/(?<=\[)[Xx ](?=\])/g,e.link_regex=/(?<![\\])\[[^\]]*\]\(([^\(]+)\)|<([^>\s]+\.[^>\s]+)>|((?:[a-zA-Z0-9\+\.\-])+:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|(?:[a-zA-Z0-9\+\.\-])+:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,}[^\)])|joplin:\/\/x-callback-url\/.*/g,e.image_regex=/!\[[^\]]*\]\([^\(]+\)/g,e.html_image_regex=/<img([^>]+?)\/?>/g,e.highlight_regex=/(?<!\\)==(?=[^\s])[^=]*[^=\s\\]==/g,e.insert_regex=/(?<!\\)\+\+(?=[^\s])[^\+]*[^\+\s\\]\+\+/g,e.sub_regex=/(?<![\\~])~(?=[^\s])[^~]*[^~\s\\]~/g,e.sup_regex=/(?<![\\[])\^(?=[^\s])[^\^]*[^\^\s\\[]\^/g,e.emph_star_regex=/(?<![\\\*])\*(?!\*)/g,e.emph_underline_regex=/(?<![\\\_])\_(?!\_)/g,e.strong_star_regex=/(?<![\\\*])\*\*(?!\*)/g,e.strong_underline_regex=/(?<![\\\_])\_\_(?!\_)/g,e.highlight_token_regex=/(?<![\\=])==(?!=)/g,e.insert_token_regex=/(?<![\\\+])\+\+(?!\+)/g,e.sub_token_regex=/(?<![\\~])~(?!~)/g,e.sup_token_regex=/(?<![\\\^])\^(?!\^)/g,e.strike_token_regex=/(?<![\\~])~~(?!~~)/g,e.header_regex=/^\s*#+\s/g,e.list_token_regex=/^(\s*)([*+-] \[[Xx ]\]\s|[*+->]\s|(\d+)([.)]\s))(\s*)/g,e.hr_regex=/^([*\-_])(?:\s*\1){2,}\s*$/,e.blockquote_regex=/^\s*\>+\s/g,e.table_regex=/^\|[^\n]+\|/g;const i=[r("rm-checkbox",e.checkbox_regex,[]),r("rm-checkbox-check",e.checkbox_inner_regex,["extraCSS"]),r("rm-link",e.link_regex,[]),r("rm-image",e.image_regex,[]),r("rm-image",e.html_image_regex,[]),r("rm-list-token",e.list_token_regex,[]),r("rm-ins",e.insert_regex,["insertHighlight"]),r("rm-sub",e.sub_regex,["subHighlight"]),r("rm-sup",e.sup_regex,["supHighlight"]),r("rm-header-token",e.header_regex,["extraCSS"]),r("line-cm-rm-blockquote",e.blockquote_regex,["extraCSS"]),r("rm-em-token",e.emph_star_regex,["extraCSS"]),r("rm-em-token",e.emph_underline_regex,["extraCSS"]),r("rm-strong-token",e.strong_star_regex,["extraCSS"]),r("rm-strong-token",e.strong_underline_regex,["extraCSS"]),r("rm-highlight",e.highlight_regex,["markHighlight"]),r("rm-highlight-token",e.highlight_token_regex,["extraCSS","markHighlight"]),r("rm-ins-token",e.insert_token_regex,["extraCSS","insertHighlight"]),r("rm-sub-token",e.sub_token_regex,["extraCSS","subHighlight"]),r("rm-sup-token",e.sup_token_regex,["extraCSS","supHighlight"]),r("rm-strike-token",e.strike_token_regex,["extraCSS"]),r("rm-hr line-cm-rm-hr",e.hr_regex,["extraCSS"])];function o(t,e){for(let n of e)if(!t[n])return!1;return!0}e.add=function(t){if(t.state.richMarkdown)for(let e of i)o(t.state.richMarkdown.settings,e.requiredSettings)&&t.addOverlay(e)},e.remove=function(t){for(let e of i)t.removeOverlay(e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.toggleCheckbox=e.getItemsAt=e.TextItemType=e.clickAt=e.getClickCoord=e.getMatchAt=e.isCheckbox=e.isLink=void 0;const r=n(0);function i(t,e,n){let r=null;if(e.lastIndex=0,!e.global)return console.error("getMatchAt requires a global regex; Consider adding a `g` after ${regex}"),null;do{if(r=e.exec(t),!r)break;const i=r.index,o=i+r[0].length;if(i<=n&&n<=o)return r}while(r);return null}var o;function s(t,e){let{line:n,ch:o}=e;const s=t.getLine(n),c=i(s,r.link_regex,o);if(!c)return;let a="";for(let t=1;t<=4;t++)a=a||c[t];return a&&a.endsWith(")")?i(s,r.image_regex,o)&&(a=a.slice(0,a.length-1)):a&&(a.endsWith('"')||a.endsWith("'"))&&(a=a.slice(0,a.length-1)),a=a.split(" ")[0],a}function c(t,e){const{line:n,ch:o}=e,s=t.getLine(n),c=i(s,r.checkbox_regex,o);return c&&c[3]?{match:c,lineText:s,line:n}:null}function a(t,e){const n=t.getCursor(),{match:r,line:i,lineText:o}=c(t,e);let s=o.indexOf(r[3]),a=s+r[3].length;const l=" "===r[3][1]?"[x]":"[ ]";return t.replaceRange(l,{ch:s,line:i},{ch:a,line:i},"+input"),t.setCursor(n,null,{scroll:!1}),!0}e.isLink=function(t){return!!t.target&&t.target.classList.contains("cm-rm-link")},e.isCheckbox=function(t){return!!t.target&&t.target.classList.contains("cm-rm-checkbox")},e.getMatchAt=i,e.getClickCoord=function(t,e){return(n=t.coordsChar({left:e.clientX,top:e.clientY})).sticky&&"before"===n.sticky?{ch:n.ch-1,line:n.line}:n;var n},e.clickAt=function(t,e){if(!t.state.richMarkdown)return;const n=t.state.richMarkdown.settings;if(n.links){const n=s(t,e);if(n)return{name:"followLink",url:n}}return n.checkbox&&a(t,e),null},function(t){t.Link="link",t.Checkbox="checkbox"}(o=e.TextItemType||(e.TextItemType={})),e.getItemsAt=function(t,e){if(!t.state.richMarkdown)return null;const n=t.state.richMarkdown.settings;let r=[];if(n.links){const n=s(t,e);n&&r.push({type:o.Link,url:n,coord:e})}if(n.checkbox){c(t,e)&&r.push({type:o.Checkbox,coord:e})}return r},e.toggleCheckbox=a},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{a(r.next(t))}catch(t){o(t)}}function c(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}a((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=n(3),o=n(1),s=n(0),c=n(4);t.exports={default:function(t){return{plugin:function(e){function n(e){return r(this,void 0,void 0,(function*(){return yield t.postMessage({name:"getResourcePath",id:e})}))}function a(t,e){const n=t.state.richMarkdown.settings;if(!n.clickCtrl)return!0;let r=!1;return n.clickAlt&&(r=r||e.altKey),r=navigator.platform.toUpperCase().indexOf("MAC")>=0?r||e.metaKey:r||e.ctrlKey,r}function l(t,n,r){c.onRenderLine(t,n,r,e)}function u(t,e){const{from:n,to:r}=function(t){const e=t.from.line;let n=t.to.line;return n-=t.removed.length,n+=t.text.length,{from:e,to:n}}(e);i.onSourceChanged(t,n,r)}function g(t){i.afterSourceChanges(t)}function h(e,n){return r(this,void 0,void 0,(function*(){if(!e.state.richMarkdown)return;if(a(e,n)&&(o.isLink(n)||o.isCheckbox(n))){const r=o.getClickCoord(e,n),i=o.clickAt(e,r);i&&t.postMessage(i),n.preventDefault()}}))}function d(t,e,n){if(!n.target)return;let r="";(e.links&&o.isLink(n)||e.checkbox&&o.isCheckbox(n))&&(r=a(t,n)?"pointer":r);n.target.style.cursor=r}e.defineExtension("initializeRichMarkdown",(function(t){this.state.richMarkdown={settings:t,path_from_id:n},this.on("change",u),this.on("update",g),this.on("mousedown",h),this.on("renderLine",l),s.add(this),c.calculateSpaceWidth(this),this.updateRichMarkdownSettings(t)})),e.defineExtension("updateRichMarkdownSettings",(function(t){var e,n;this.state.richMarkdown&&(this.state.richMarkdown.settings=t,i.clearAllWidgets(this),i.onSourceChanged(this,this.firstLine(),this.lastLine()),i.afterSourceChanges(this),t.activeLine?this.setOption("styleActiveLine",{nonEmpty:!0}):this.setOption("styleActiveLine",!1),this.getWrapperElement().onmousemove=(e=this,n=t,function(t){d(e,n,t)}),this.getWrapperElement().onmouseup=function(t,e){return function(n){d(t,e,n)}}(this,t))})),e.defineExtension("clickUnderCursor",(function(){const e=this.getCursor("head"),n=o.clickAt(this,e);n&&t.postMessage(n)})),e.defineExtension("getItemsUnderCursor",(function(t){const e=this.getCursor("head");return o.getItemsAt(this,e)})),e.defineExtension("toggleCheckbox",(function(t){o.toggleCheckbox(this,t)})),e.defineExtension("refreshResource",(function(t){i.refreshResource(this,t)})),e.defineOption("enable-rich-mode",!1,(function(n,o,c){return r(this,void 0,void 0,(function*(){if(c&&c!=e.Init&&(n.off("change",u),n.off("update",g),n.off("mousedown",h),n.off("renderLine",l),s.remove(n),n.state.richMarkdown=null,i.clearAllWidgets(n)),o){setTimeout((function e(i){return r(this,void 0,void 0,(function*(){const o=yield function(){return r(this,void 0,void 0,(function*(){return yield t.postMessage({name:"getSettings"})}))}();o?n.initializeRichMarkdown(o):setTimeout(e,2*i,2*i)}))}),50,100)}}))}))},codeMirrorResources:["addon/selection/active-line","addon/selection/mark-selection"],codeMirrorOptions:{"enable-rich-mode":!0,styleSelectedText:!0},assets:function(){return[{mime:"text/css",inline:!0,text:".cm-rm-monospace {\n\t\t\t\t\t\t\t\t\t\t\tfont-family: monospace !important;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t.cm-rm-ins {\n\t\t\t\t\t\t\t\t\t\t\ttext-decoration: underline;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t.cm-rm-sub {\n\t\t\t\t\t\t\t\t\t\t\tvertical-align: sub;\n\t\t\t\t\t\t\t\t\t\t\tfont-size: smaller;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t.cm-rm-sup {\n\t\t\t\t\t\t\t\t\t\t\tvertical-align: super;\n\t\t\t\t\t\t\t\t\t\t\tfont-size: smaller;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t.cm-rm-highlight {\n\t\t\t\t\t\t\t\t\t\t\tbackground-color: var(--joplin-search-marker-background-color);\n\t\t\t\t\t\t\t\t\t\t\tcolor: var(--joplin-search-marker-color);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t.CodeMirror-selectedtext.cm-rm-highlight {\n\t\t\t\t\t\t\t\t\t\t\tbackground-color: #e5d3ce;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t/* Needed for the renderLine indent hack to work */\n\t\t\t\t\t\t\t\t\t\t.CodeMirror pre > * { text-indent: 0px; }\n\t\t\t\t\t\t\t"}]}}}}},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{a(r.next(t))}catch(t){o(t)}}function c(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}a((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.clearAllWidgets=e.refreshResource=e.afterSourceChanges=e.onSourceChanged=e.html_image_line_regex=e.image_inline_regex=e.image_line_regex=void 0;const i=n(1),o=n(0);e.image_line_regex=/^\s*!\[([^\]]*)\]\((<[^\)]+>|[^)\s]+)[^)]*\)\s*$/,e.image_inline_regex=/!\[([^\]]*)\]\((<[^\)]+>|[^)\s]+)[^)]*\)/g,e.html_image_line_regex=/^\s*<img([^>]+?)\/?>\s*$/;let s={};function c(t){return function(n){return r(this,void 0,void 0,(function*(){if(!n.target)return;if(!t.state.richMarkdown)return;if(!t.state.richMarkdown.settings.imageHover)return;if(!t.state.richMarkdown.settings.imageHoverCtrl&&(!n.ctrlKey&&!n.altKey||t.state.richMarkdown.isMouseHovering))return;t.state.richMarkdown.isMouseHovering=!0;const s=n.target;if(!s.offsetParent)return;if(t.state.richMarkdown.settings.inlineImages&&s.parentNode.childNodes.length<=3)return;const c=yield function(t,n){return r(this,void 0,void 0,(function*(){let{line:r,ch:s}=n;const c=t.getLine(r),a=i.getMatchAt(c,e.image_inline_regex,s);let l=null;if(a)l=yield g(a[2],a[1],t.state.richMarkdown.path_from_id);else{const e=i.getMatchAt(c,o.html_image_regex,s);e&&(l=yield u(e[0],t.state.richMarkdown.path_from_id))}return l}))}(t,i.getClickCoord(t,n));if(c){if(c.style.zoom){let t=parseFloat(c.style.zoom);c.style.zoom.endsWith("%")&&(t/=100),t&&(c.width*=t,c.height*=t,c.style.zoom="100%")}c.style.visibility="hidden",s.offsetParent.appendChild(c),c.style.position="absolute",c.style.zIndex="1000",c.classList.add("rich-markdown-hover-image"),c.onload=function(){if(!t.state.richMarkdown)return;if(!t.state.richMarkdown.isMouseHovering)return void c.remove();let e=this;const r=s.offsetParent,{right:i,width:o}=r.getBoundingClientRect();let a=0;e.clientWidth<o&&(a=Math.min(n.clientX,i-e.clientWidth));const l=t.coordsChar({left:a,top:n.clientY},"page");e.style.visibility="visible",t.addWidget(l,c,!1)}}}))}}function a(t){const e=t.getWrapperElement().getElementsByClassName("rich-markdown-hover-image");for(let t=e.length-1;t>=0;t--)e[t].remove()}function l(t){return function(e){t.state.richMarkdown&&(t.state.richMarkdown.isMouseHovering=!1),a(t)}}function u(t,e){return r(this,void 0,void 0,(function*(){const n=(new DOMParser).parseFromString(t,"text/html").body.firstChild;n.style.height=n.style.height||"auto",n.style.maxWidth=n.style.maxWidth||"100%";const r=["script","noscript","iframe","frameset","frame","object","base","embed","link","meta"];for(let t=0;t<n.attributes.length;t++){const e=n.attributes[t].name;(r.includes(e)||e.startsWith("on"))&&(n.attributes[t].value="")}if(n.src.length>=34){const t=n.src.substring(n.src.length-34);t.startsWith(":/")&&(n.src=yield e(t.substring(2)),n.id=t.substring(2))}return n}))}function g(t,e,n){return r(this,void 0,void 0,(function*(){let r=t.substring(2);t.startsWith(":/")&&34==t.length&&(t=yield n(r)),t.startsWith("<")&&t.endsWith(">")&&(t=t.substring(1,t.length-1));const i=document.createElement("img");return i.src=t,i.alt=e,i.style.maxWidth="100%",i.style.height="auto",i.id=r,i}))}e.onSourceChanged=function(t,n,i){t.state.richMarkdown&&t.state.richMarkdown.settings.inlineImages&&function(t,n,i){var o,c,a;r(this,void 0,void 0,(function*(){if(!t.state.richMarkdown)return;const r=t.state.richMarkdown.path_from_id;let l=!1;for(let h=n;h<=i;h++){const n=t.lineInfo(h);if(n.widgets)for(const t of n.widgets)"rich-markdown-resource"===t.className&&t.clear(),delete s[t.node.id];if(!n)continue;const i=t.getStateAfter(h,!0);if((null==i?void 0:i.outer)&&((null===(o=null==i?void 0:i.outer)||void 0===o?void 0:o.code)||(null===(a=null===(c=null==i?void 0:i.outer)||void 0===c?void 0:c.thisLine)||void 0===a?void 0:a.fencedCodeEnd)))continue;const d=n.text.match(e.image_line_regex);let f=null;if(d)f=yield g(d[2],d[1],r);else{const t=n.text.match(e.html_image_line_regex);t&&(f=yield u(t[0],r))}if(f){const e=t.addLineWidget(h,f,{className:"rich-markdown-resource"});s[f.id]=e,l=!0}}l&&t.refresh()}))}(t,n,i)},e.afterSourceChanges=function(t){t.state.richMarkdown&&t.state.richMarkdown.settings.imageHover&&function(t){if(!t.state.richMarkdown)return;const e=t.getWrapperElement().getElementsByClassName("cm-rm-image");for(let n of e)n.onmouseenter=c(t),n.onmouseleave=l(t),t.state.richMarkdown.settings.imageHoverCtrl||(n.onmousemove=c(t))}(t)},e.refreshResource=function(t,e){const n=(new Date).getTime();let r=s[e];const i=r.node.src.split("?t=")[0],o=r.node.height;r.node.onload=function(){0!=this.getClientRects().length&&this.height!=o&&t.refresh()},r.node.src=`${i}?t=${n}`},e.clearAllWidgets=function(t){a(t);for(let t in s)s[t].clear();s={},t.refresh()}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.onRenderLine=e.calculateSpaceWidth=void 0;const r=n(0);let i=0,o=0,s=0;function c(t,e,n){let r=document.createElement("span");n&&r.classList.add(n),r.style.whiteSpace="pre-wrap",r.appendChild(document.createTextNode(e.repeat(10)));const i=t.getWrapperElement().getElementsByClassName("CodeMirror-measure")[0];i.firstChild&&i.removeChild(i.firstChild),i.appendChild(r);const o=r.getBoundingClientRect();return(o.right-o.left)/10||t.defaultCharWidth()}e.calculateSpaceWidth=function(t){i=c(t," ",""),o=c(t," ","cm-rm-monospace"),s=c(t,">","")},e.onRenderLine=function(t,e,n,c){if(t.state.richMarkdown&&t.state.richMarkdown.settings.alignIndent){const a=e.text.match(r.list_token_regex);if(!a)return;let l=c.countColumn(e.text,a[0].length,t.getOption("tabSize"))*i;t.state.richMarkdown.settings.enforceMono&&a[0].indexOf("[")>0?l+=6*o-6*i:t.state.richMarkdown.settings.enforceMono&&a[0].indexOf(">")>=0&&(l+=s-i),n.style.textIndent="-"+l+"px",n.style.paddingLeft=l+"px"}}}]).default;